{% extends "base.html" %}

{% block title %}Doculyze | Analyzer{% endblock %}
{% block add_style %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap-slider.min.css') }}">
{% endblock add_style %}
{% block page_content %}
<div id="search-dialog">
    <div id="search-dialog-title"></div>
    <button class="close" onclick="toggleSearchDialog();">
        <span>&times;</span>
    </button>
    <div id="row">
        <div class="col-sm-12">
            <div class="col-sm-9" id="search-dialog-main"></div>
            <div style="float: left;">
                <div class="search-side part-of-speech">
                    <h4>Select a Word:</h4>
                    <div id="pos-words">
                    </div>
                </div>
                <div class="search-side word-box">
                    <h4></h4>
                    <div id="heading-words">
                    </div>                    
                </div>            
            </div>
        </div>
    </div>
</div>
<div id="search-keyword-dialog">
    <button class="close" onclick="toggleKeywordDialog();">
        <span>&times;</span>
    </button>
    <div id="search-keyword-container">
        <h1>Search results for "<span class="keyword-heading"></span>" ...</h1>
        <div class="custom-keyword-container">
            <div class="keyword-heading"></div>
        </div>
        <div class="load-keyword">
            <img class="loading" src="{{ url_for('static', filename='css/loading.gif') }}" />
        </div>
        <div class="no-keyword" style="display:none;">
            No results found
        </div>
    </div>
</div>
<div id="search-term-container">
    <div id="search-keyword-box">
        <input type="text" id="search-keyword" placeholder="Search Keyword"/>
    </div>
    <div id="search-term-box">
        <div id="add-term"><span>+</span></div>
    </div>
    <button id="search-btn" onclick="search();">Search</button>
</div>
<div id="search-result-container">
    <div id="journal-count">
        <svg id="corpus-count" width="400" height="100"></svg>
        <svg id="search-count" width="400" height="100"></svg>
    </div>
    {% if search_result %}
        {% for result in search_result %}
        <div class="doc" id="doc-{{result['id']}}">
            <h3>ARTICLE</h3>                
            <div class="doc-title">{{ result["title"]|safe }}</div>
            <div class="doc-author">{{ result["author"]|safe }}</div>
            <div class="doc-cite">{{ result["citation"]|safe }}</div>
            <h3>TOP KEYWORDS</h3>
            <ul class="doc-term" id="doc-topic">
            {% for topic in result["topiclist"] %}
            {% if topic['dist'] > 0.1 %}
            <li>
                <a id="{{ topic['id'] }}" onclick="drawKeyword('{{ topic['name']|safe }}');" class="search-term {% if topic['id'] in search_term %}active{% endif %}">{{loop.index}}. {{ topic["name"]|safe }}</a>
            </li>
            {% endif %}
            {% endfor %}
            </ul>
            <h3>SEARCH TERMS</h3>
            <ul class="doc-term" id="doc-people">
            {% for entity in result["entitylist"] %}
            {% if entity["type"] == "nompers" %}                
            <li>
                <a class="search-term">{{ entity["name"]|safe }}</a>
            </li>
            {% endif %}
            {% endfor %}              
            </ul>
        </div>
        {% endfor %}
    {% endif %}
</div>
{% endblock page_content %}
{% block add_js %}
<script src="{{ url_for('static', filename='js/explore.js') }}"></script>
<script>
    {% if tier_index %}
        var parent_tier = "{{tier_index['parent']}}";
        var home_tier = "{{tier_index['home']}}";
        var child_tier = "{{tier_index['child']}}";
    {% else %}
        var parent_tier = "root";
        var home_tier = "1.NA.NA.NA.NA.NA.NA.1";
        var child_tier = "1.1.NA.NA.NA.NA.NA.1";
    {% endif %}

    {% if search_term %}
        {% for term in search_term %}
            // drawSearchTerm("{{term['tier_index']|safe}}", "{{ term['heading_id'] }}", "{{ term['heading']|safe }}", 0);
            drawKeyword("{{term['name']|safe}}", "{{term['heading_id']|safe}}");
        {% endfor %}
    {% endif %}
</script>
<script src="{{ url_for('static', filename='js/analyzer.js') }}"></script>
{% endblock add_js %}